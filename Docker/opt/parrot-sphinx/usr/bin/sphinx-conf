# find what is the root, from which sphinx is installed
root="$(cd "$(dirname "$0")"; pwd -P)"
root=${root%usr/bin}
sphinx_conf_d="/etc/parrot-sphinx/sphinx.conf.d"


# set path for all the files generated by sphinx
if [ -z "${SPHINX_HOME+x}" ]; then
    if [ -d "${HOME}" ]; then
        export SPHINX_HOME=${HOME}/.parrot-sphinx
    else
        export SPHINX_HOME=/tmp/parrot-sphinx
    fi
fi

conf_files=$(shopt -s nullglob; echo "${sphinx_conf_d}"/*.conf)
# override with sphinx dev workspace conf if it exists
sphinx_conf_d="$root/etc/parrot-sphinx/sphinx.conf.d"
conf_files+=" $(shopt -s nullglob; echo "${sphinx_conf_d}"/*.conf)"
conf_files+=" $(shopt -s nullglob; echo "${SPHINX_HOME}"/sphinx.conf.d/*.conf)"
sphinx_env=$(mktemp)
${root}/usr/bin/sphinx-conf-reader SPHINX $conf_files > "$sphinx_env"
source "$sphinx_env"
cat "$sphinx_env"
rm "$sphinx_env"
